---
title: "Statistics 440 Individual Project"
author: "Austin Kao"
date: "3/3/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
library(readxl)
library(tidyverse)
```


# Introduction

Energy is a crucial part of the US economy.

Our main goal for this analysis is to assess the environmental impact of US power plants. We are primarily interested in examining the amount of energy generated by power plants and its environmental impact.

### Dataset

The data we will use for this analysis comes primarily from the US Energy Information Administration (EIA), a government agency that gathers data about the country's operational power plants. The EIA collects generator-specific data on each combined heat and power plant in the nation through surveys on form 860 and form 923. For our response variable, we will use 

# Methodology

```{r}
prices <- read_excel("Sales_Ult_Cust_2019.xlsx", skip=2)
prices <- rename(prices, "Total Revenue" = `Total Revenue Thousand Dollars`)
power <- read_excel("EIA923_Schedules_2_3_4_5_M_12_2019_Final_Revision.xlsx", skip = 5)
operations <- read_excel("Operational_Data_2019.xlsx", skip=2)
#power2 <- power2 %>% filter(`Sector` != 2)
power <- rename(power, "Generation" = `Net Generation (Megawatthours)`)
power <- rename(power, "Fuel Type" = `Reported Fuel Type Code`)
power <- rename(power, "Utility Number" = `Operator Id`)
nonrenew <- list("ANT", "BIT", "LIG", "SGC", "SUB", "WC", "RC", "DFO", "JF", "KER", "PC", "PG", "RFO", "SGP", "WO", "BFG", "NG", "OG", "SC")
renew <- list("AB", "MSW", "OBS", "WDS", "OBL", "SLW", "BLQ", "WDL", "LFG", "OBG", "SUN", "WND", "GEO", "WAT", "MSB")
other <- list("WAT", "PUR", "WH", "TDF", "MWH", "OTH", "MSN")
isNonRenew <- function (value) {
  return (value %in% nonrenew)
}
isRenew <- function (value) {
  return (value %in% renew)
}
isOther <- function (value) {
  return (value %in% other)
}
power$`Fuel Type` <- if_else(sapply(power$`Fuel Type`, FUN = isNonRenew), "nonrenew", power$`Fuel Type`)
power$`Fuel Type` <- if_else(sapply(power$`Fuel Type`, FUN = isRenew), "renew", power$`Fuel Type`)
power$`Fuel Type` <- if_else(sapply(power$`Fuel Type`, FUN = isOther), "other", power$`Fuel Type`)
power$`Fuel Type` <- if_else(power$`Fuel Type`=="NUC", "nuclear", power$`Fuel Type`)
```

```{r}
power_summary <- power %>% group_by(`Utility Number`) %>% 
  summarise(prop_fuel_nonrenew = sum(`Fuel Type`=="nonrenew")/n(),
            prop_fuel_renew = sum(`Fuel Type`=="renew")/n(),
            prop_fuel_other = sum(`Fuel Type`=="other")/n(),
            prop_fuel_nuclear = sum(`Fuel Type`=="nuclear")/n(),
            total_gen = sum(Generation),
            prop_gen_renew = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="renew", Generation, 0))/total_gen, 0),
            prop_gen_nuclear = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="nuclear", Generation, 0))/total_gen, 0),
            prop_gen_nonrenew = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="nonrenew", Generation, 0))/total_gen, 0),
            prop_gen_other = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="other", Generation, 0))/total_gen, 0),
            nerc = `NERC Region`)
price_summary <- merge(prices, power_summary, by="Utility Number")
price_summary$surplus <- price_summary$total_gen - price_summary$`Total Sales Megawatthours`
price_summary <- merge(operations, price_summary, by="Utility Number")
price_summary$average_price <- price_summary$`Total Revenue`/price_summary$`Total Sales Megawatthours`
```

```{r}
price_summary$majority_renew <- if_else(price_summary$prop_gen_renew + price_summary$prop_gen_nuclear > 0.5, 1, 0)
```


```{r}
# Read in the data
#power_plants <- read.csv("global_power_plant_database.csv")
#power1 <- read_excel("1___Utility_Y2019.xlsx", skip = 1)
#power2 <- read_excel("2___Plant_Y2019.xlsx", skip = 1)
#power3 <- read_excel("EIA923_2019_1.xlsx", skip = 5)
#comp <- read_excel("annual_emission_comparison_2019_vs_2020.xlsx", skip = 4, sheet = "CO2 - All Units")
#emission <- read_excel("emissions2019.xlsx", skip=1)
#so2 <- read_excel("emissions2019.xlsx", skip=1, sheet = "SO2")
#nox <- read_excel("emissions2019.xlsx", skip=1, sheet = "NOx")
```

```{r}
#proposed <- read_excel("EIA923_Schedules_2_3_4_5_M_12_2019_Final_Revision.xlsx", skip = 5, sheet = "Proposed")
#retired <- read_excel("EIA923_Schedules_2_3_4_5_M_12_2019_Final_Revision.xlsx", skip = 5, sheet = "Retired/Cancelled")
```


```{r}
length(unique(power2$`Plant Code`))
length(unique(power2$`Plant Name`))
length(unique(power3$`Plant Id`))
length(unique(power3$`Plant Name`))
length(unique(comp$`Facility Name`))
length(unique(emission$`Plant Code`))
length(unique(so2$`Plant Code`))
length(unique(nox$`Plant Code`))
```
```{r}
sum(emission$`Metric Tonnes of CO2 Emissions`, na.rm = TRUE)
```
```{r}
ggplot(price_summary, mapping = aes(y=average_price,x=prop_gen_renew)) +
  geom_point() + 
  labs(x = "Generation")
```

```{r}
ggplot(price_summary, mapping = aes(x=average_price, fill = majority_renew)) +
  geom_histogram() + 
  labs(x = "Average Price")
```

```{r}
m1 <- lm(average_price ~ majority_renew + nerc + `Summer Peak Demand`, data = price_summary)
summary(m1)
```


To fit this model, we will fit a ordinary least squares regression model. We chose this model because when examining our EDA, the response variable may have a linear relationship with the predictor variables.

We will use the following model:  
$y = \beta_1x+\beta_0$  
In the above model, y is the response and x is the predictor variable.

A linear regression model assumes that a linear relationship exists between the response variable and a linear combination of the predictor variables. Another assumption is that the variance of the model residuals is constant for all sets of predictor variables. We will plot the residuals of the model against fitted values to verify that these assumptions are satisfied. Another assumption is that the model residuals form a normal distribution around the mean of the response, which we will verify using a Normal QQ-plot. The last assumption is that there is independence between observations. Unfortunately, because the same company could have built many of the same kind of power plant, we cannot be sure that power plants will be independent of each other. However, for sensitivity analysis, we will try other models to ensure that our findings are robust.


# References

“Nuclear explained”. Energy Information Administration, https://www.eia.gov/energyexplained/nuclear/.

“Is Nuclear Energy Renewable? The Future of Nuclear Energy”. Inspire, 29 April 2020, https://www.inspirecleanenergy.com/blog/clean-energy-101/is-nuclear-energy-renewable#:~:text=Yes%2C%20the%20energy%20that%20is,235%2C%20which%20is%20comparatively%20rare.

“Energy and Climate Change”. European Environment Agency, 23 November 2020, https://www.eea.europa.eu/signals/signals-2017/articles/energy-and-climate-change.

“Provide Energy from Fusion”. National Academy of Engineering, http://www.engineeringchallenges.org/9079.aspx

Ulmer-Scholle, Dana S. "The Basics of Nuclear Energy - Why Nuclear Power?". https://geoinfo.nmt.edu/resources/uranium/why.html


# Extra Text

NOTE: DO NOT READ. Is not part of the case study, is text that may or not be used in future iterations of this case study


One of the most pressing issues of today is man-made climate change. Climate change is spurred by the emission of greenhouse gases into the atmosphere. The energy sector, which burns fossil fuels to help generate power for electricity, heating, industry, and transport, contributes about two thirds of global greenhouse gas emissions, motivating a push to find renewable and sustainable energy sources to replace fossil fuels (Energy, 2020). One such source is nuclear energy, which is generated when the nucleus of an atom breaks apart, a process known as fission (Is Nuclear Energy Renewable?, 2020). Nuclear energy can also be generated through a fusion reaction, but current fusion technologies are unable to scale up the reactions for commercial use (Provide). Nuclear reactors often use uranium-235 as a fuel source, but there are a few that use plutonium instead (Nuclear explained).

Our main goal for this analysis is to assess the environmental impact of US power plants. We are primarily interested in examining if any significant relationships exist between the plants' type of fuel used and the plants' environmental impact.

One point that proponents of nuclear energy often raise is that a nuclear power plant will often produce much more energy than a non-nuclear one, including plants that rely on hydro, wind, and solar power (Ulmer-Scholle). However, we want to examine whether or not this is necessarily the case. Power plants can have accidents that cause them to shut down for some time. Power plants can also require fuel; in the case of a nuclear power plant, uranium is required. If fuel is scarce, then the power plant won't be able to operate at full capacity. Like many things, power plants need maintenance, which can involve shutting down the plant for some time. For this case study, we will examine if the energy we expect a nuclear power plant to produce in a given year significantly higher than the energy produced by a non-nuclear power plant. By answering this question, we can evaluate how effective nuclear energy will be at generating the necessary to power the modern world compared to the alternatives.

To answer how much energy we expect nuclear and non-nuclear power plants to produce, we will look at the total Megawatt hours produced in a year as our response variable. For our predictor variables, we will use country, year, the proportion of energy that comes from nuclear power plants, the country's population, the country's GDP, and the type of power used at the reactor. We are primarily interested in the type of power used at the reactor. Because nuclear energy is only used by 30 countries in the world, the country becomes a significant variable. Factors like population, GDP, and the proportion of energy that comes from nuclear power plants control for the wealth of a nation and the amount of its economic investment in nuclear power. For our null hypothesis, we assume that there is no significant difference in the energy production of a nuclear power plant compared to a non-nuclear one.