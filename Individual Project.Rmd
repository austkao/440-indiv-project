---
title: "Statistics 440 Individual Project"
author: "Austin Kao"
date: "3/3/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
library(readxl)
library(tidyverse)
```

```{r}
prices <- read_excel("Sales_Ult_Cust_2019.xlsx", skip=2)
prices <- rename(prices, "Total Revenue" = `Total Revenue Thousand Dollars`)
power <- read_excel("EIA923_Schedules_2_3_4_5_M_12_2019_Final_Revision.xlsx", skip = 5)
operations <- read_excel("Operational_Data_2019.xlsx", skip=2)
#power2 <- power2 %>% filter(`Sector` != 2)
power <- rename(power, "Generation" = `Net Generation (Megawatthours)`)
power <- rename(power, "Fuel Type" = `Reported Fuel Type Code`)
power <- rename(power, "Utility Number" = `Operator Id`)
nonrenew <- list("ANT", "BIT", "LIG", "SGC", "SUB", "WC", "RC", "DFO", "JF", "KER", "PC", "PG", "RFO", "SGP", "WO", "BFG", "NG", "OG", "SC")
renew <- list("AB", "MSW", "OBS", "WDS", "OBL", "SLW", "BLQ", "WDL", "LFG", "OBG", "SUN", "WND", "GEO", "WAT", "MSB")
other <- list("WAT", "PUR", "WH", "TDF", "MWH", "OTH", "MSN")
isNonRenew <- function (value) {
  return (value %in% nonrenew)
}
isRenew <- function (value) {
  return (value %in% renew)
}
isOther <- function (value) {
  return (value %in% other)
}
power$`Fuel Type` <- if_else(sapply(power$`Fuel Type`, FUN = isNonRenew), "nonrenew", power$`Fuel Type`)
power$`Fuel Type` <- if_else(sapply(power$`Fuel Type`, FUN = isRenew), "renew", power$`Fuel Type`)
power$`Fuel Type` <- if_else(sapply(power$`Fuel Type`, FUN = isOther), "other", power$`Fuel Type`)
power$`Fuel Type` <- if_else(power$`Fuel Type`=="NUC", "nuclear", power$`Fuel Type`)
```

```{r}
enviro <- read_excel("EIA923_Schedule_8_Annual_Environmental_Information_2019_Final_Revision.xlsx", skip = 4, sheet = "8B Financial Information")
enviro_summary <- enviro %>% group_by(`Plant ID`) %>% 
  summarise(total = `Total Other O and M Expense`)
enviro_summary <- rename(enviro_summary, "Plant Id" = `Plant ID`)
power <- merge(power, enviro_summary, by = "Plant Id")
```


```{r}
power_summary <- power %>% group_by(`Utility Number`) %>% 
  summarise(prop_fuel_nonrenew = sum(`Fuel Type`=="nonrenew")/n(),
            prop_fuel_renew = sum(`Fuel Type`=="renew" | `Fuel Type`=="nuclear")/n(),
            prop_fuel_other = sum(`Fuel Type`=="other")/n(),
            prop_fuel_nuclear = sum(`Fuel Type`=="nuclear")/n(),
            total_gen = sum(Generation),
            prop_gen_renew = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="renew", Generation, 0))/total_gen, 0),
            prop_gen_nuclear = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="nuclear", Generation, 0))/total_gen, 0),
            prop_gen_nonrenew = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="nonrenew", Generation, 0))/total_gen, 0),
            prop_gen_other = if_else(total_gen != 0, sum(if_else(`Fuel Type`=="other", Generation, 0))/total_gen, 0),
            nerc = `NERC Region`)
price_summary <- merge(prices, power_summary, by="Utility Number")
price_summary$surplus <- price_summary$total_gen - price_summary$`Total Sales Megawatthours`
price_summary <- merge(operations, price_summary, by="Utility Number")
price_summary$average_price <- price_summary$`Total Revenue`/(price_summary$`Total Sales Megawatthours`)
```

```{r}
price_summary$majority_renew <- if_else(price_summary$prop_gen_renew + price_summary$prop_gen_nuclear > 0.5, 1, 0)
```
```{r}
power$`Renewable` <- if_else(power$`Fuel Type`=="renew"|power$`Fuel Type`=="nuclear", 1, 0)
```


# Introduction

One of the most pressing issues of today is man-made climate change. Climate change is spurred by the emission of greenhouse gases into the atmosphere. The energy sector, which burns fossil fuels to help generate power for electricity, heating, industry, and transport, contributes about two thirds of global greenhouse gas emissions, motivating a push to find renewable and sustainable energy sources to replace fossil fuels (Energy, 2020). While renewables become more widespread and accessible, many have criticized its economic cost and value compared to non-renewables.

Our main goal for this analysis is to assess the economic performance of renewable power plants compared to non-renewable ones. We plan to do so by examining the relationship between the average price of electricity sold by electric utilities in the United States and the proportion of power plants utilities operate that run on renewable energy sources. We also would like to examine the relationship between the electrical output of a power plant and the type of energy that a power plant uses.

### Dataset

The data we will use for this analysis comes primarily from the US Energy Information Administration (EIA), a government agency that gathers data about the country's operational power plants. The EIA collects generator-specific data on the electricity generation throughout the nation through surveys each power plant completes known as Form 923. It also collects data on the finances of electric utilities throughout the nation through surveys each utility completes known as Form 861.

To model the performance of electrical utilities, for our response variable, we will use the average price of the electricity sold, measured in dollars per kilowatt-hour, by utilities in the year 2019. Our main predictor is the proportion of power plants utilities operate that run on renewable energy sources. This is because we are interested in how utilities will perform economically as they shift towards renewable energy more and more. We will consider the NERC (North American Electricity Reliability Corporation) region the utility is based in since each region sets its own regulatory standards. 

To model the performance of electrical power plants, for our response variable, we will use the net generation of electricity, measured in Megawatthours, by power plants in the year 2019. Our main predictor is the type of fuel the power plant uses, which can renewable, nonrenewable, nuclear, or some other type of fuel as classified by the EIA. This is because we are interested in which energy sources significantly outperform the others. We will, once again, consider the NERC (North American Electricity Reliability Corporation) region the utility is based in since each region sets its own regulatory standards.

### EDA
```{r}
ggplot(price_summary, mapping = aes(x=average_price)) +
  geom_histogram() + 
  labs(x = "Average Price")
```

```{r}
ggplot(price_summary, mapping = aes(y=average_price,x=prop_fuel_renew)) +
  geom_point() + 
  labs(x = "Proportion of renewable power plants", y = "Average price ($/kWh)")
```
```{r}
ggplot(power, mapping = aes(x=Generation)) +
  geom_histogram() + 
  labs(x = "Generation (Megawatthours)")
```


# Methodology


To fit these models, we will fit ordinary least squares regression models. We chose this type of model because when examining our EDA, the response variable may have a linear relationship with our predictor variables. Other models that were considered include a Bayesian model, where we would incorporate some prior belief into our model.

To find the impact of renewables on the average price of electricity, we will use the following model:  
$y_i = \beta_0+\beta_1 NERC region_i+\beta_2PeakSummerDemand_i $  
In the above model, y is the average price of electricity for the $i^{th}$ utility.

To find the impact of renewables on the net electrical output, we will use the following model:  
$y_i = \beta_0+\beta_1 NERC region_i $  
In the above model, y is the electricity generated for the $i^{th}$ power plant.

A ordinary least-squares regression model assumes that a linear relationship exists between the response variable and a linear combination of the predictor variables as well as that the variance of the model residuals is constant for all sets of values for the predictor variables. To verify that these assumptions are reasonable, we plot the residuals of the model against the fitted values. Another assumption we make is that the model residuals form a normal distribution around the mean of the response, which we will verify using a Normal QQ-plot. The last assumption is that there is independence between observations.

We plan to try other models to ensure that our findings are robust.

Unfortunately, because the same company could have built many of the same kind of power plant, we cannot be sure that power plants will be independent of each other. However, for sensitivity analysis, we will try other models to ensure that our findings are robust.


```{r}
#length(unique(power2$`Plant Code`))
#length(unique(power2$`Plant Name`))
length(unique(power$`Plant Id`))
length(unique(prices$`Utility Number`))
length(unique(power$`Utility Number`))
#length(unique(power3$`Plant Name`))
#length(unique(comp$`Facility Name`))
#length(unique(emission$`Plant Code`))
#length(unique(so2$`Plant Code`))
#length(unique(nox$`Plant Code`))
```
```{r}
sum(emission$`Metric Tonnes of CO2 Emissions`, na.rm = TRUE)
```


```{r}
#ggplot(price_summary, mapping = aes(x=average_price, fill = majority_renew)) +
#  geom_histogram() + 
#  labs(x = "Average Price")
```
# Results

```{r}
m1 <- lm(average_price ~ prop_fuel_renew + nerc + `Summer Peak Demand`, data = price_summary)
summary(m1)
```
```{r}
m2 <- lm(`Generation` ~ `Fuel Type` + `NERC Region`, data = power)
summary(m2)
```


# Discussion

After generating the results above, it is clear that 

# References

“Nuclear explained”. Energy Information Administration, https://www.eia.gov/energyexplained/nuclear/.

“Is Nuclear Energy Renewable? The Future of Nuclear Energy”. Inspire, 29 April 2020, https://www.inspirecleanenergy.com/blog/clean-energy-101/is-nuclear-energy-renewable#:~:text=Yes%2C%20the%20energy%20that%20is,235%2C%20which%20is%20comparatively%20rare.

“Energy and Climate Change”. European Environment Agency, 23 November 2020, https://www.eea.europa.eu/signals/signals-2017/articles/energy-and-climate-change.

“Provide Energy from Fusion”. National Academy of Engineering, http://www.engineeringchallenges.org/9079.aspx

Ulmer-Scholle, Dana S. "The Basics of Nuclear Energy - Why Nuclear Power?". https://geoinfo.nmt.edu/resources/uranium/why.html


# Extra Text

NOTE: DO NOT READ. Is not part of the case study, is text that may or not be used in future iterations of this case study


One of the most pressing issues of today is man-made climate change. Climate change is spurred by the emission of greenhouse gases into the atmosphere. The energy sector, which burns fossil fuels to help generate power for electricity, heating, industry, and transport, contributes about two thirds of global greenhouse gas emissions, motivating a push to find renewable and sustainable energy sources to replace fossil fuels (Energy, 2020). One such source is nuclear energy, which is generated when the nucleus of an atom breaks apart, a process known as fission (Is Nuclear Energy Renewable?, 2020). Nuclear energy can also be generated through a fusion reaction, but current fusion technologies are unable to scale up the reactions for commercial use (Provide). Nuclear reactors often use uranium-235 as a fuel source, but there are a few that use plutonium instead (Nuclear explained).

Our main goal for this analysis is to assess the environmental impact of US power plants. We are primarily interested in examining if any significant relationships exist between the plants' type of fuel used and the plants' environmental impact.

One point that proponents of nuclear energy often raise is that a nuclear power plant will often produce much more energy than a non-nuclear one, including plants that rely on hydro, wind, and solar power (Ulmer-Scholle). However, we want to examine whether or not this is necessarily the case. Power plants can have accidents that cause them to shut down for some time. Power plants can also require fuel; in the case of a nuclear power plant, uranium is required. If fuel is scarce, then the power plant won't be able to operate at full capacity. Like many things, power plants need maintenance, which can involve shutting down the plant for some time. For this case study, we will examine if the energy we expect a nuclear power plant to produce in a given year significantly higher than the energy produced by a non-nuclear power plant. By answering this question, we can evaluate how effective nuclear energy will be at generating the necessary to power the modern world compared to the alternatives.

To answer how much energy we expect nuclear and non-nuclear power plants to produce, we will look at the total Megawatt hours produced in a year as our response variable. For our predictor variables, we will use country, year, the proportion of energy that comes from nuclear power plants, the country's population, the country's GDP, and the type of power used at the reactor. We are primarily interested in the type of power used at the reactor. Because nuclear energy is only used by 30 countries in the world, the country becomes a significant variable. Factors like population, GDP, and the proportion of energy that comes from nuclear power plants control for the wealth of a nation and the amount of its economic investment in nuclear power. For our null hypothesis, we assume that there is no significant difference in the energy production of a nuclear power plant compared to a non-nuclear one.